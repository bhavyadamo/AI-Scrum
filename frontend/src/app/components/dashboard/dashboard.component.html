<div class="dashboard-container p-4">
  <div class="row mb-4">
    <div class="col-md-8">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h4 class="mb-0">Sprint Overview</h4>
          <div>
            <div class="d-flex align-items-center">
              <div class="input-group input-group-sm me-2" style="max-width: 250px;">
                <input 
                  type="text" 
                  class="form-control" 
                  placeholder="Enter Iteration Path" 
                  [(ngModel)]="selectedIterationPath"
                  (keyup.enter)="loadIterationData()"
                  aria-label="Iteration Path">
                <button 
                  class="btn btn-outline-primary" 
                  type="button" 
                  (click)="loadIterationData()"
                  title="Load data for this iteration path">
                  <i class="bi bi-search"></i>
                </button>
              </div>
              <button class="btn btn-primary btn-sm" (click)="reload()">
                <i class="bi bi-arrow-clockwise"></i> Refresh
              </button>
            </div>
          </div>
        </div>
        <div class="card-body">
          <div *ngIf="loading.sprint" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
          
          <div *ngIf="error.sprint" class="alert alert-danger">
            {{ error.sprint }}
          </div>
          
          <div *ngIf="!loading.sprint && !error.sprint && sprintOverview">
            <h2 class="sprint-title">{{ decodeIterationPath(sprintOverview.sprintName) }}</h2>
            <div class="d-flex justify-content-between mt-3">
              <div>
                <p class="text-muted mb-1">Start Date</p>
                <p class="fw-bold">{{ sprintOverview.startDate | date:'longDate' }}</p>
              </div>
              <div>
                <p class="text-muted mb-1">End Date</p>
                <p class="fw-bold">{{ sprintOverview.endDate | date:'longDate' }}</p>
              </div>
              <div>
                <p class="text-muted mb-1">Days Remaining</p>
                <p class="fw-bold days-remaining">{{ sprintOverview.daysRemaining }}</p>
              </div>
            </div>
            <div class="mt-3">
              <p class="text-muted mb-1">Iteration Path</p>
              <p class="fw-bold">{{ decodeIterationPath(sprintOverview.iterationPath) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="col-md-4">
      <div class="card">
        <div class="card-header">
          <h4 class="mb-0">AI Assistant</h4>
        </div>
        <div class="card-body d-flex flex-column" style="height: 350px;">
          <!-- Chat Messages -->
          <div class="chat-messages flex-grow-1 overflow-auto mb-3">
            <div *ngIf="chatMessages.length === 0" class="text-center py-4">
              <p class="text-muted">Ask me anything about your project or tasks.</p>
              <div class="chat-examples">
                <h4>Try asking me:</h4>
                <ul>
                  <li>What are the current sprint details?</li>
                  <li>How many tasks are in this sprint?</li>
                  <li>Show me the work distribution by team member</li>
                  <li>Who has the most tasks assigned?</li>
                  <li>Can you assign task #123 to John?</li>
                  <li>Suggest someone for the next task assignment</li>
                  <li>What's the current sprint progress?</li>
                </ul>
              </div>
            </div>
            
            <div *ngFor="let msg of chatMessages" class="message mb-2"
                 [ngClass]="{'user-message': msg.role === 'user', 'assistant-message': msg.role === 'assistant'}">
              <div class="message-content">
                <div class="message-text">{{ msg.content }}</div>
                <div class="message-time small text-muted">{{ msg.timestamp | date:'shortTime' }}</div>
              </div>
            </div>
          </div>
          
          <!-- Chat Input -->
          <div class="chat-input">
            <div class="input-group">
              <input type="text" class="form-control" 
                     placeholder="Type your message..." 
                     [(ngModel)]="currentMessage"
                     (keyup.enter)="sendChatMessage()">
              <button class="btn btn-primary" type="button" (click)="sendChatMessage()">
                <i class="bi bi-send"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Task Distribution Cards -->
  <div class="card mb-4">
    <div class="card-header">
      <h4 class="mb-0">Task Distribution by Status</h4>
    </div>
    <div class="card-body">
      <!-- Loading indicator -->
      <div *ngIf="loadingTaskDetails" class="text-center py-4">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading work item data...</span>
        </div>
        <p class="mt-2">Fetching real-time work item counts from API...</p>
      </div>
      
      <!-- Error message -->
      <div *ngIf="taskDetailsError" class="alert alert-danger">
        {{ taskDetailsError }}
      </div>
      
      <!-- No data message -->
      <div *ngIf="!loadingTaskDetails && (!taskStatusBoard || taskStatusBoard.length === 0) && !taskDetailsError" class="text-center py-4">
        <p class="text-muted">No work item state data available. Please select an iteration and click Search.</p>
      </div>
      
      <!-- Task Status Cards -->
      <div *ngIf="!loadingTaskDetails && taskStatusBoard && taskStatusBoard.length > 0" class="row">
        <div *ngFor="let status of taskStatusBoard" class="col-md-2 mb-3">
          <div class="card task-state-card h-100" [style.background-color]="status.color">
            <div class="card-body text-center text-white p-3">
              <h1 class="mb-0 display-4 fw-bold">{{ status.count }}</h1>
              <p class="mb-0 small status-label">{{ status.status }}</p>
              <p class="mb-0 small status-label">Work Items</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Task Distribution by Type -->
  <div class="card mb-4">
    <div class="card-header">
      <h4 class="mb-0">Work Items by Type</h4>
    </div>
    <div class="card-body">
      <!-- Type Distribution Cards -->
      <div *ngIf="!loadingTaskDetails && tasksByType && tasksByType.length > 0" class="row">
        <div *ngFor="let typeItem of tasksByType" class="col-md-3 mb-3">
          <div class="card task-type-card h-100" [style.border-left-color]="typeItem.color">
            <div class="card-body p-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0 card-title">{{ typeItem.type }}</h5>
                <span class="badge rounded-pill" [style.background-color]="typeItem.color">{{ typeItem.count }}</span>
              </div>
              <div class="progress">
                <div class="progress-bar" [style.width.%]="(typeItem.count / getTotalWorkItems()) * 100" 
                     [style.background-color]="typeItem.color">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- No data message -->
      <div *ngIf="!loadingTaskDetails && (!tasksByType || tasksByType.length === 0) && !taskDetailsError" class="text-center py-4">
        <p class="text-muted">No work item type data available.</p>
      </div>
    </div>
  </div>
</div> 